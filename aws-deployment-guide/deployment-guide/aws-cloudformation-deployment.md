# AWS CloudFormation Deployment

Metaflow ships with an [AWS CloudFormation template](https://github.com/Netflix/metaflow-tools/tree/master/aws/cloudformation) that automates the deployment of all the AWS resources needed to enable cloud-scaling in Metaflow. The [Metaflow Sandbox](https://docs.metaflow.org/metaflow-on-aws/metaflow-sandbox) uses a version of this template to automatically vend out sandboxes for evaluating Metaflow.

The major components of the template are:

* **Amazon S3** - A dedicated private bucket and all appropriate permissions to serve as a centralized storage backend.
* **AWS Batch** - A dedicated AWS Batch Compute Environment and Job Queue to extend Metaflow's compute capabilities to the cloud.
* **Amazon CloudWatch** - Configuration to store and manage AWS Batch job execution logs.
* **AWS Step Functions** - A dedicated role to allow scheduling Metaflow flows on AWS Step Functions.
* **Amazon Event Bridge** - A dedicated role to allow time-based triggers for Metaflow flows configures on AWS Step Functions.
* **Amazon DynamoDB** - A dedicated Amazon DynamoDB table for tracking certain step executions on AWS Step Functions.
* **Amazon Sagemaker** - An Amazon Sagemaker Notebook instance for interfacing with Metaflow flows.
* **AWS Fargate and Amazon Relational Database Service** - A Metadata service running on AWS Fargate with a PostGres DB on Amazon Relational Database Service to log flow execution metadata.
* **Amazon API Gateway** -  A dedicated TLS termination point and an optional point of basic API authentication via key to provide secure, encrypted access to metadata service.
* **Amazon VPC Networking** - a VPC with \(2\) customizable subnets and Internet connectivity.
* **AWS Identity and Access Management** - Dedicated roles obeying "principle of least privilege" access to resources such as AWS Batch and Amazon Sagemaker Notebook instances.

## Steps for AWS CloudFormation Deployment

1. Navigate to _Services_ and select _CloudFormation_ under the _Management and Governance_ heading \(or search for it in the search bar\) in your AWS console.
2. Click _Create stack_ and select _With new resources \(standard\)_.
3. Download the template from [this location](https://github.com/Netflix/metaflow-tools/blob/master/aws/cloudformation/metaflow-cfn-template.yml) and save it locally.
4. Ensure _Template is ready_ remains selected, choose _Upload a template file_, and click _Choose file_ and upload the file saved in previous step.
5. Name your stack, select your parameters, and click _Next_, noting that if you enable _APIBasicAuth_ and/or _CustomRole_, further configuration will be required after deployment. 
6. If desired, feel free to tag your stack in whatever way best fits your organization. When finished, click _Next_.
7. Ensure you select the check box next to _I acknowledge that AWS CloudFormation might create IAM resources._ and click _Create stack_.
8. Wait roughly 10-15 minutes for deployment to complete. The Stack status will eventually change to _CREATE\_COMPLETE_.

![](../../.gitbook/assets/screencapture-us-west-2-console-aws-amazon-cloudformation-home-2020-07-27-14_22_27.png)

Once complete, you'll find an _Outputs_ tab that contains values for the components generated by this CloudFormation template. Those values correlate to respective environment variables \(listed next to the outputs\) you'll set to enable cloud features within Metaflow.

![](../../.gitbook/assets/screencapture-us-west-2-console-aws-amazon-cloudformation-home-2020-07-27-14_28_17.png)

Using these values, you can [configure your metaflow installation](./#configuring-metaflow).

